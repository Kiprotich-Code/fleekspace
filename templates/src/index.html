<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleekspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen">
    <!-- Navigation -->
    <nav class="p-4 bg-gray-900 text-white">
        <ul class="flex justify-center space-x-8 font-medium">
            <li><a href="#" class="hover:text-gray-300">Home</a></li>
            <li><a href="#" class="hover:text-gray-300">Categories</a></li>
            <li><a href="#" class="hover:text-gray-300">Sponsor</a></li>
        </ul>
    </nav>

    <!-- Header -->
    <header class="relative bg-gradient-to-r from-blue-500 to-purple-600 text-white text-center py-16">
        <div class="absolute inset-0 opacity-30">
            <img src="https://source.unsplash.com/1600x900/?nature,travel" alt="Background"
                class="w-full h-full object-cover">
        </div>
        <h1 class="relative text-5xl font-extrabold">Fleekspace</h1>
        <p class="relative mt-4 text-lg">Discover amazing articles and insights</p> 
    </header>

    <!-- Articles Section -->
    <main class="container mx-auto p-6">
        <h2 class="text-3xl font-bold text-center mb-6">Latest Articles</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="articles-container">
            <!-- Article dynamically loaded -->
        </div>

        <div class="text-center mt-8">
            <button id="load-more-btn" class="bg-blue-500 text-white px-4 py-2 rounded" onclick="fetchArticles()">
                Load More
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white text-center py-6 sticky-[100vh]">
        <p class="text-lg">Thanks for being part of us, bro!</p>
        <p class="text-sm mt-2">Â© 2024 Fleekspace. All rights reserved.</p>
    </footer>

    <script>
        const url = 'http://127.0.0.1:8000/blog/';
        const articlesContainer = document.getElementById('articles-container');
        const loadMoreButton = document.getElementById('load-more');

        let nextPage = 1;
        let currentPage = 1; // Track the current page
        let allArticles = []; // Store all loaded articles

        async function fetchArticles() {
            try {
                const response = await fetch(`${url}?page=${currentPage}`);
                if (!response.ok) {
                    console.error(`HTTP Error: ${response.status} - ${response.statusText}`);
                    throw new Error('Failed to fetch articles');
                }
                const data = await response.json();
                console.log('Fetched articles:', data);

                // Avoid duplicates by filtering already loaded articles
                const newArticles = data.filter(article =>
                    !allArticles.some(existing => existing.id === article.id)
                );

                allArticles = [...allArticles, ...newArticles]; // Update the loaded articles
                renderArticles(newArticles);

                if (newArticles.length === 0) {
                    console.log('No more articles to load');
                    document.querySelector('#load-more-btn').disabled = true; // Disable Load More
                } else {
                    currentPage += 1; // Increment page for next request
                }
            } catch (error) {
                console.error('Error fetching articles:', error);
            }
        }

        function renderArticles(articles) {
            if (!articles || articles.length === 0) {
                console.log('No new articles to display');
                return;
            }

            const articlesContainer = document.querySelector('#articles-container');

            articles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.classList.add('article', 'p-4', 'border', 'rounded', 'mb-4');
                articleElement.innerHTML = `
            <h2 class="font-bold text-xl mb-2">${article.title}</h2>
            <p class="text-gray-600 mb-4">By ${article.author} | ${new Date(article.created_at).toLocaleDateString()}</p>
            <p>${article.body.substring(0, 100)}...</p>
            <a href="article.html?id=${article.id}" class="text-blue-500 underline">Read More</a>
        `;
                articlesContainer.appendChild(articleElement);
            });
        }


        // Load initial items and setup Load More button
        fetchArticles();
    </script>
</body>

</html>